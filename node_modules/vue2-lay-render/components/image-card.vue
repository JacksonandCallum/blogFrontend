<template>
  <div ref="image" class="image-card">
    <div class="image-container" @click="clickImg">
      <div
        class="image"
        :style="{
          width: currentW + '%',
        }"
      >
        <img @load="onImage" :src="src" alt="" v-show="!loading" />
        <img
          src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='1px' height='1px' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3E%3C/title%3E%3Cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' fill-opacity='0'%3E%3Cg transform='translate(-249.000000, -126.000000)' fill='%23FFFFFF'%3E%3Crect x='249' y='126' width='1' height='1'%3E%3C/rect%3E%3C/g%3E%3C/g%3E%3C/svg%3E"
          alt=""
          v-if="loading"
          class="empty-img"
        />
      </div>
      <div v-if="content.tips" class="tips">{{ content.tips }}</div>
    </div>
  </div>
</template>

<script>
export default {
  name: "WorkspaceJsonImageCard",
  props: {
    content: {
      default() {
        return {};
      },
    },
  },
  data() {
    return {
      currentW: "",
      src: "",
      loading: true,
    };
  },
  watch: {
    content: {
      immediate: true,
      deep: true,
      handler() {
        this.$nextTick(() => {
          this.initState();
        });
      },
    },
  },
  mounted() {
    addEventListener("resize", () => {
      this.initState();
    });
  },
  methods: {
    initState() {
      if (!this.content.src) this.loading = true;
      this.src = this.content.src;
      let style = this.content.style;
      this.currentW = style.width;

      // if (!this.$refs.image) return;
      // let clientWidth = this.$refs.image.clientWidth;
      // let clientHeight = document.body.clientHeight;
      // let style = this.content.style;
      // this.src = this.content.src;
      // let w = clientWidth * style.ratioW;
      // let h = clientHeight * style.ratioH;
      // this.maxWidth = w > 0 ? w + "px" : "200px";
      // this.maxHeight = h > 0 ? h + "px" : "200px";
    },
    onImage(event) {
      this.loading = false;
    },
    clickImg() {
      this.$emit("clickImg", this.src);
    },
  },
};
</script>

<style lang="scss" scoped>
.image-card {
  display: flex;
  justify-content: center;
}

.image-container {
  width: 100%;
  padding: 20px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.image-container .image {
  display: flex;
  background: #f5f5f5;
  position: relative;
}

.empty-img {
  background: #f5f5f5
    url("data:image/svg+xml;charset=utf-8,%3Csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient x1='94.087%25' y1='0%25' x2='94.087%25' y2='90.559%25' id='a'%3E%3Cstop stop-color='%23606060' stop-opacity='0' offset='0%25'/%3E%3Cstop stop-color='%23606060' stop-opacity='.3' offset='100%25'/%3E%3C/linearGradient%3E%3ClinearGradient x1='100%25' y1='8.674%25' x2='100%25' y2='90.629%25' id='b'%3E%3Cstop stop-color='%23606060' offset='0%25'/%3E%3Cstop stop-color='%23606060' stop-opacity='.3' offset='100%25'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg fill='none' fill-rule='evenodd' opacity='.9'%3E%3Cpath d='M40 0c22.091 0 40 17.909 40 40S62.091 80 40 80v-7c18.225 0 33-14.775 33-33S58.225 7 40 7V0z' fill='url(%23a)'/%3E%3Cpath d='M40 0v7C21.775 7 7 21.775 7 40s14.775 33 33 33v7C17.909 80 0 62.091 0 40S17.909 0 40 0z' fill='url(%23b)'/%3E%3Ccircle fill='%23606060' cx='40.5' cy='3.5' r='3.5'/%3E%3CanimateTransform attributeName='transform' begin='0s' dur='1s' type='rotate' values='0 40 40;360 40 40' repeatCount='indefinite'/%3E%3C/g%3E%3C/svg%3E")
    no-repeat 50% 50%;
  background-size: 16px;
  border-radius: 5px;
}

.tips {
  text-align: center;
  color: #999;
  font-size: 12px;
  padding-top: 10px;
}
</style>
