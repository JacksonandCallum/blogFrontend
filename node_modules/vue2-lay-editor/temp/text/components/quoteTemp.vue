<template>
  <div :id="token" class="quote-text">
    <div class="quote-text-section">
      <div
        @keyup="onHandler"
        @input="onHandler"
        @mouseup="onHandler"
        @click="onHandler"
        id="layEditor-container"
        ref="layEditor-container"
      ></div>
    </div>
    <select-color
      :index="parent.index"
      :current="parent.current"
      @change="selectColor"
    ></select-color>
  </div>
</template>

<script>
const actions = [
  "bold",
  "underline",
  "strikeThrough",
  "justifyLeft",
  "justifyCenter",
  "justifyRight",
];
import selectColor from "../../../components/select-color.vue";
import urils from "../../../utils/utils";
export default {
  name: "default-text",
  components: {
    selectColor,
  },
  props: {},
  inject: ["parent"],
  data() {
    return {
      token: "token" + urils.createUid(),
      commandState: [],
    };
  },
  mounted() {},

  watch: {
    "parent.token": {
      immediate: true,
      handler() {
        this.$nextTick(() => {
          this.$refs["layEditor-container"].innerHTML =
            this.parent.content.template;
        });
      },
    },
  },
  methods: {
    onHandler(content) {
      this.onCommandState();
      let template = this.$refs["layEditor-container"].innerHTML;
      this.$emit("change", {
        template: template,
      });
    },
    selectColor(item) {
      let dom = document.querySelector(`#${this.token} #layEditor-richText`);
      dom.style.backgroundColor = item.background;
      dom.style.borderColor = item.color;
      this.onHandler();
    },
    onCommandState() {
      this.commandState = actions.filter((item) =>
        document.queryCommandState(item)
      );
      this.$emit("commandState", this.commandState);
    },
  },
};
</script>

<style lang="scss"></style>
