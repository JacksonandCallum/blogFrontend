<template>
  <div class="extend-card">
    <div class="extend-card-section">
      <dropdown-select v-model="show">
        <!-- 展示 -->
        <div slot="title" class="extend-card-content">
          <div class="layeditor-iframe" v-html="value"></div>
          <div @click="open" class="extend-card-edit">编辑</div>
        </div>
        <!-- 操作 -->
        <div>
          <extend-content :value="value" @confirm="setExtend"></extend-content>
        </div>
      </dropdown-select>
    </div>
  </div>
</template>

<script>
import extendContent from "../../components/extend-content.vue";
import dropdownSelect from "../../components/dropdown-select";
let temp = (data) => {
  return `
  <div style="padding:10px 0">
    <div
      style="
        display: flex;
        justify-content: center;
      "
    >
      <div style="background: #f5f5f5;display: flex;">
        ${data}
      </div>
    </div>
  </div>
  `;
};

export default {
  name: "extend-card",
  components: {
    extendContent,
    dropdownSelect,
  },
  props: {
    content: {
      default() {
        return {};
      },
    },
    token: {
      default: "",
    },
  },
  data() {
    return {
      value: "",
      show: false,
    };
  },
  watch: {
    token: {
      immediate: true,
      handler() {
        this.value = this.content.text;
        this.onChange();
      },
    },
  },
  mounted() {},
  methods: {
    setExtend(data) {
      this.value = data;
      this.show = false;
      this.onChange();
    },
    onChange() {
      this.$emit("change", {
        text: this.value,
        template: temp(this.value),
      });
    },
    open() {
      setTimeout(() => {
        this.show = true;
      }, 1);
    },
  },
};
</script>

<style lang="scss" scoped>
.extend-card {
  padding: 10px;
  display: flex;
  justify-content: center;
}
// 内容 区域

.extend-card-content {
  position: relative;
}
.extend-card-content .layeditor-iframe {
  background: #f5f5f5;
  display: flex;
}

.extend-card-edit {
  width: 60px;
  height: 40px;
  line-height: 40px;
  text-align: center;
  background: #f5f5f5;
  position: absolute;
  right: -10px;
  top: 50%;
  margin-left: 10px;
  transform: translate(100%, -50%);
  cursor: pointer;
}
</style>
