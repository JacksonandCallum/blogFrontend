<template>
  <div :id="scoped" class="default-text">
    <div class="title-section">
      <div
        @keyup="onHandler"
        @input="onHandler"
        @mouseup="onHandler"
        @click="onHandler"
        id="layEditor-container"
        ref="layEditor-container"
      ></div>
    </div>
    <select-color
      :index="index"
      :current="current"
      @change="selectColor"
    ></select-color>
  </div>
</template>
<script>
const actions = [
  "bold",
  "underline",
  "strikeThrough",
  "justifyLeft",
  "justifyCenter",
  "justifyRight",
];
import selectColor from "../../components/select-color.vue";
import urils from "../../utils/utils";

export default {
  name: "default-text",
  components: {
    selectColor,
  },
  props: {
    themeType: {
      default: 1,
    },
    content: {
      default() {
        return {};
      },
    },
    token: {
      default: "",
    },
    index: {
      default: 0,
    },
    current: {
      default: null,
    },
  },
  data() {
    return {
      commandState: [],
      scoped: "token" + urils.createUid(),
    };
  },
  mounted() {},
  watch: {
    token: {
      immediate: true,
      handler() {
        this.$nextTick(() => {
          this.$refs["layEditor-container"].innerHTML = this.content.template;
        });
      },
    },
  },
  methods: {
    onHandler() {
      this.onCommandState();
      let template = this.$refs["layEditor-container"].innerHTML;
      this.$emit("change", {
        template: template,
      });
    },
    selectColor(item) {
      if (
        ["title-type1", "title-type2", "title-type3"].includes(this.themeType)
      ) {
        let icon = document.querySelector(`#${this.scoped} #laytEditor-icon`);
        let text = document.querySelector(
          `#${this.scoped} #layEditor-richText`
        );
        icon.style.backgroundColor = item.color;
        text.style.color = item.color;
      } else if (["title-type4"].includes(this.themeType)) {
        let icons = document.querySelectorAll(
          `#${this.scoped} #laytEditor-icon`
        );
        let text = document.querySelector(
          `#${this.scoped} #layEditor-richText`
        );
        text.style.color = item.color;
        icons.forEach((i) => (i.style.borderColor = item.color));
      } else if (["title-type5"].includes(this.themeType)) {
        let icon = document.querySelector(`#${this.scoped} #laytEditor-icon`);
        icon.style.backgroundColor = item.color;
      }
      this.onHandler();
    },
    onCommandState() {
      this.commandState = actions.filter((item) =>
        document.queryCommandState(item)
      );
      this.$emit("commandState", this.commandState);
    },
  },
};
</script>

<style lang="scss">
.title-section {
  // padding: 2px 0;
}
.title-section #layEditor-richText {
  outline: none;
  overflow: auto;
  font-family: system, -apple-system, BlinkMacSystemFont, PingFang SC, Segoe UI,
    Microsoft YaHei, wenquanyi micro hei, Hiragino Sans GB, Hiragino Sans GB W3,
    Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue,
    Helvetica, Arial, sans-serif;
  line-height: 1.75;
  font-size: 16px;
  word-break: break-all;
  -moz-user-modify: read-write;
  -webkit-user-modify: read-write;
}

.title-section #layEditor-richText {
  ul,
  ol {
    padding-left: 20px;
  }
}

.title-section #layEditor-richText li {
  list-style-type: "ðŸ”¸";
  padding-left: 5px;
}
#layEditor-richText ol li {
  list-style-type: decimal;
}

.title-section #layEditor-richText:empty::before {
  content: attr(placeholder);
  color: #c0c4cf;
}
</style>
