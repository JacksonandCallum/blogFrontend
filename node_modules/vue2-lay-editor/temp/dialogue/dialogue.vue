<template>
  <div :id="scoped" class="layEditor-dialogue">
    <div class="title-section">
      <div
        @keyup="onHandler"
        @input="onHandler"
        @mouseup="onHandler"
        @click="onHandler"
        id="layEditor-container"
        ref="layEditor-container"
      ></div>
    </div>
  </div>
</template>
<script>
const actions = [
  "bold",
  "underline",
  "strikeThrough",
  "justifyLeft",
  "justifyCenter",
  "justifyRight",
];
import urils from "../../utils/utils";

export default {
  name: "dialogue",
  components: {},
  props: {
    themeType: {
      default: 1,
    },
    content: {
      default() {
        return {};
      },
    },
    token: {
      default: "",
    },
  },
  data() {
    return {
      commandState: [],
      scoped: "token" + urils.createUid(),
    };
  },

  mounted() {},
  watch: {
    token: {
      immediate: true,
      handler() {
        this.$nextTick(() => {
          this.$refs["layEditor-container"].innerHTML = this.content.template;
        });
      },
    },
  },
  methods: {
    onHandler() {
      this.onCommandState();
      let template = this.$refs["layEditor-container"].innerHTML;
      let leftText = document.querySelector(
        `#${this.scoped} .layEditor-richText-left`
      );
      let rightText = document.querySelector(
        `#${this.scoped} .layEditor-richText-right`
      );

      this.$emit("change", {
        template: template,
        leftImg: this.content.leftImg,
        rightImg: this.content.rightImg,
        leftText: leftText.innerHTML,
        rightText: rightText.innerHTML,
      });
    },
    // 监听剪贴板 粘贴去除格式
    optimizePasteEvent(e) {
      e.stopPropagation();
      e.preventDefault();
      let text = "";
      const event = e.originalEvent || e;
      // 获取 剪贴板 格式化后的内容
      if (event.clipboardData && event.clipboardData.getData) {
        text = event.clipboardData.getData("text/plain");
      } else if (window.clipboardData && window.clipboardData.getData) {
        text = window.clipboardData.getData("Text");
      }
      // 插入内容
      if (document.queryCommandSupported("insertText")) {
        document.execCommand("insertHTML", true, text);
        return;
      } else if (document.execCommand) {
        document.execCommand("paste", false, text);
        return;
      }
    },
    onCommandState() {
      this.commandState = actions.filter((item) =>
        document.queryCommandState(item)
      );
      this.$emit("commandState", this.commandState);
    },
  },
};
</script>

<style lang="scss">
.layEditor-dialogue {
}
.layEditor-dialogue #layEditor-richText {
  outline: none;
  overflow: auto;
  word-break: break-all;
  font-family: system, -apple-system, BlinkMacSystemFont, PingFang SC, Segoe UI,
    Microsoft YaHei, wenquanyi micro hei, Hiragino Sans GB, Hiragino Sans GB W3,
    Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue,
    Helvetica, Arial, sans-serif;
  line-height: 1.75;
  font-size: 16px;
  word-break: break-word;
  -moz-user-modify: read-write;
  -webkit-user-modify: read-write;
}

.layEditor-dialogue #layEditor-richText {
  ul,
  ol {
    padding-left: 20px;
  }
}

.layEditor-dialogue #layEditor-richText li {
  list-style-type: "🔸";
  padding-left: 5px;
}
#layEditor-richText ol li {
  list-style-type: decimal;
}

.layEditor-dialogue #layEditor-richText:empty::before {
  content: attr(placeholder);
  color: #c0c4cf;
}
</style>
