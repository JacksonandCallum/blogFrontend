"use strict";(self["webpackChunkblog_frontend"]=self["webpackChunkblog_frontend"]||[]).push([[662],{19662:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center","margin-top":"30px"}},[e("div",[e("el-avatar",{staticClass:"user-avatar",attrs:{size:60,src:t.currentUser.avatar},nativeOn:{click:function(e){return t.changeDialog("修改头像")}}})],1),e("div",{staticClass:"myCenter",staticStyle:{"margin-top":"12px"}},[t._m(0),e("div",{staticClass:"user-content"},[e("div",[e("el-input",{attrs:{maxlength:"30"},model:{value:t.currentUser.username,callback:function(e){t.$set(t.currentUser,"username",e)},expression:"currentUser.username"}})],1),e("div",[t.$common.isEmpty(t.currentUser.phone)?e("div",[e("span",{staticClass:"changeInfo",on:{click:function(e){return t.changeDialog("绑定手机号")}}},[t._v("绑定手机号（功能未接入）")])]):e("div",[t._v(" "+t._s(t.currentUser.phone)+" "),e("span",{staticClass:"changeInfo",on:{click:function(e){return t.changeDialog("修改手机号")}}},[t._v("修改（功能未接入）")])])]),e("div",[t.$common.isEmpty(t.currentUser.email)?e("div",[e("span",{staticClass:"changeInfo",on:{click:function(e){return t.changeDialog("绑定邮箱")}}},[t._v("绑定邮箱")])]):e("div",[t._v(" "+t._s(t.currentUser.email)+" "),e("span",{staticClass:"changeInfo",on:{click:function(e){return t.changeDialog("修改邮箱")}}},[t._v("修改")])])]),e("div",[e("el-radio-group",{model:{value:t.currentUser.sex,callback:function(e){t.$set(t.currentUser,"sex",e)},expression:"currentUser.sex"}},[e("el-radio",{staticStyle:{"margin-right":"10px"},attrs:{label:"薛定谔的猫"}}),e("el-radio",{staticStyle:{"margin-right":"10px"},attrs:{label:"男"}}),e("el-radio",{attrs:{label:"女"}})],1)],1),e("div",[e("el-input",{attrs:{maxlength:"60",type:"textarea","show-word-limit":""},model:{value:t.currentUser.info,callback:function(e){t.$set(t.currentUser,"info",e)},expression:"currentUser.info"}})],1)])]),e("div",{staticStyle:{"margin-top":"20px"}},[e("proButton",{attrs:{info:"提交",before:t.$constant.before_color_2,after:t.$constant.after_color_2},nativeOn:{click:function(e){return t.submitUserInfo()}}})],1)]),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.showDialog,width:"30%","append-to-body":!0,"close-on-click-modal":!1,center:""},on:{"update:visible":function(e){t.showDialog=e}}},[e("div",{staticClass:"myCenter",staticStyle:{"flex-direction":"column"}},[e("div",["修改手机号"===t.dialogTitle||"绑定手机号"===t.dialogTitle?e("div",[e("div",{staticStyle:{"margin-bottom":"5px"}},[t._v("手机号：")]),e("el-input",{model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}}),e("div",{staticStyle:{"margin-top":"10px","margin-bottom":"5px"}},[t._v("验证码：")]),e("el-input",{model:{value:t.code,callback:function(e){t.code=e},expression:"code"}}),e("div",{staticStyle:{"margin-top":"10px","margin-bottom":"5px"}},[t._v("密码：")]),e("el-input",{model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1):"修改邮箱"===t.dialogTitle||"绑定邮箱"===t.dialogTitle?e("div",[e("div",{staticStyle:{"margin-bottom":"5px"}},[t._v("邮箱：")]),e("el-input",{model:{value:t.InputParams.email,callback:function(e){t.$set(t.InputParams,"email",e)},expression:"InputParams.email"}}),e("div",{staticStyle:{"margin-top":"10px","margin-bottom":"5px"}},[t._v("验证码：")]),e("el-input",{model:{value:t.InputParams.code,callback:function(e){t.$set(t.InputParams,"code",e)},expression:"InputParams.code"}}),e("div",{staticStyle:{"margin-top":"10px","margin-bottom":"5px"}},[t._v("密码：")]),e("el-input",{model:{value:t.InputParams.password,callback:function(e){t.$set(t.InputParams,"password",e)},expression:"InputParams.password"}})],1):"修改头像"===t.dialogTitle?e("div",[e("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:t.$baseUrl+"/tencent/image",multiple:"","auto-upload":!0,limit:1,"on-success":t.handleCoverSuccess,"on-change":t.handleChange,"list-type":"picture",headers:{token:this.currentUser.token}}},[e("div",{staticClass:"el-upload__text"},[e("svg",{attrs:{viewBox:"0 0 1024 1024",width:"40",height:"40"}},[e("path",{attrs:{d:"M666.2656 629.4528l-113.7664-112.4864c-20.7872-20.5824-54.3232-20.5312-75.1104 0.1024l-113.3056 112.4864c-20.8896 20.736-21.0432 54.528-0.256 75.4688 20.736 20.8896 54.528 21.0432 75.4688 0.256l22.6304-22.4256v189.5936c0 29.44 23.9104 53.3504 53.3504 53.3504s53.3504-23.9104 53.3504-53.3504v-189.5424l22.6816 22.4256a53.1456 53.1456 0 0 0 37.5296 15.4112c13.7728 0 27.4944-5.2736 37.9392-15.8208 20.6336-20.9408 20.4288-54.7328-0.512-75.4688z",fill:"#FFE37B"}}),e("path",{attrs:{d:"M820.992 469.504h-5.376c-3.072-163.328-136.3456-294.8096-300.4416-294.8096S217.856 306.1248 214.784 469.504H209.408c-100.7104 0-182.3744 81.664-182.3744 182.3744s81.664 182.3744 182.3744 182.3744h209.7664V761.856c-30.208 5.5808-62.464-3.3792-85.6576-26.7264-37.3248-37.5808-37.0688-98.5088 0.512-135.7824l113.3056-112.4864c37.2224-36.9664 97.8432-37.0176 135.168-0.1536l113.7664 112.4864c18.2272 18.0224 28.3648 42.0864 28.5184 67.7376 0.1536 25.6512-9.728 49.8176-27.7504 68.0448a95.40096 95.40096 0 0 1-68.3008 28.5184c-5.9392 0-11.776-0.512-17.5104-1.5872v72.3456h209.7664c100.7104 0 182.3744-81.664 182.3744-182.3744S921.7024 469.504 820.992 469.504z",fill:"#8C7BFD"}})]),e("div",[t._v("拖拽上传 / 点击上传")])]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过100MB")])])],1):t._e()]),"修改头像"!==t.dialogTitle?e("div",{staticStyle:{display:"flex","margin-top":"30px"}},[e("proButton",{directives:[{name:"show",rawName:"v-show",value:"修改手机号"===t.dialogTitle||"绑定手机号"===t.dialogTitle||"修改邮箱"===t.dialogTitle||"绑定邮箱"===t.dialogTitle,expression:"dialogTitle === '修改手机号' || dialogTitle === '绑定手机号' || dialogTitle === '修改邮箱' || dialogTitle === '绑定邮箱'"}],staticStyle:{"margin-right":"20px"},attrs:{info:t.codeString,before:t.$constant.before_color_1,after:t.$constant.after_color_1},nativeOn:{click:function(e){return t.getCode()}}}),e("proButton",{attrs:{info:"提交",before:t.$constant.before_color_2,after:t.$constant.after_color_2},nativeOn:{click:function(e){return t.submitDialog()}}})],1):t._e()])])],1)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-title"},[e("div",[t._v("用户名：")]),e("div",[t._v("手机号：")]),e("div",[t._v("邮箱：")]),e("div",[t._v("性别：")]),e("div",[t._v("简介：")])])}];const r=()=>s.e(903).then(s.bind(s,16903));var n={name:"PersonPage",components:{proButton:r},props:{currentUser:{}},data(){return{InputParams:{},avatar:"",showDialog:!1,code:"",dialogTitle:"",codeString:"验证码"}},created(){this.showAvatar()},methods:{changeDialog(t){if("邮箱验证码"===t){if(this.$common.isEmpty(this.InputParams.email))return this.$message.error("请输入邮箱！"),!1;if(!/^\w+@[a-zA-Z0-9]{2,10}(?:\.[a-z]{2,4}){1,3}$/.test(this.InputParams.email))return this.$message.error("邮箱格式有误！"),!1}this.dialogTitle=t,this.showDialog=!0},submitUserInfo(){if(!this.checkParameters())return;let t={id:this.currentUser.id,username:this.currentUser.username,sex:this.currentUser.sex};this.$common.isEmpty(this.currentUser.info)||(t.info=this.currentUser.info.trim()),this.$confirm("确认保存？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",center:!0}).then((()=>{this.$request.put("/user/update",t).then((t=>{"200"===t.code?this.$request.get("/user/selectById/"+this.currentUser.id).then((t=>{t.data.token=this.currentUser.token,this.$store.commit("loadCurrentUser",t.data),this.$message.success("修改成功！")})):this.$message.error(t.msg)}))})).catch((()=>{this.$message.warning("已取消保存!")}))},getCode(){"验证码"===this.codeString?"修改邮箱"===this.dialogTitle&&this.$request.post("/user/code/request",{email:this.InputParams.email}).then((t=>{this.$request.post("/user/code/email",{email:this.InputParams.email,code:t.data}).then((t=>{"200"===t.code&&this.$notify({title:"邮箱验证码已发送",message:"验证码有效时长5分钟, 失效请重新发送",type:"success",duration:15e3})}))})):this.$message.warning("请稍后再试！")},handleChange(t,e){console.log("文件上传状态发生变化：",t,e)},handleCoverSuccess(t){console.log("handleCoverSuccess 方法被调用了！");let e={id:this.currentUser.id,avatar:t.data};this.$request.put("/user/update",e).then((t=>{"200"===t.code&&(this.$request.get("/user/selectById/"+this.currentUser.id).then((t=>{t.data.token=this.currentUser.token,this.currentUser.avatar=t.avatar,this.$store.commit("loadCurrentUser",t.data),window.location.reload()})),this.$message.success("修改成功！"),this.showDialog=!1)}))},showAvatar(){const t=localStorage.getItem("USER");this.$store.commit("loadCurrentUser",JSON.parse(t))},submitDialog(){"修改手机号"!==this.dialogTitle&&"绑定手机号"!==this.dialogTitle&&"修改邮箱"!==this.dialogTitle&&"绑定邮箱"!==this.dialogTitle||this.updatePhoneOrEmail()},updatePhoneOrEmail(){if(this.$common.isEmpty(this.InputParams.code))return void this.$message.error("请输入验证码！");this.$common.isEmpty(this.InputParams.password)?(this.$message.error("请输入密码！"),t=!1):/(?=.*[a-zA-Z])[a-zA-Z0-9]{6,18}/.test(this.InputParams.password)||(this.$message.error("密码长度在6-18个字符，只能包含数字、大小写字母，且至少包含一个字母"),t=!1);let t=!0;if(!t)return;let e={email:this.InputParams.email.trim(),code:this.InputParams.code.trim(),password:this.InputParams.password.trim()};this.checkParams(e)&&"修改邮箱"===this.dialogTitle&&this.$request.post("/user/updateEmail",e).then((t=>{"200"===t.code?this.$request.get("/user/selectById/"+this.currentUser.id).then((t=>{t.data.token=this.currentUser.token,this.$store.commit("loadCurrentUser",t.data),this.$message.success("修改成功！"),this.InputParams.email="",this.InputParams.code="",this.InputParams.password=""})):this.$message.error(t.msg)}))},checkParameters(){return this.$common.isEmpty(this.currentUser.username)?(this.$message.error("请输入用户名！"),!1):-1===this.currentUser.username.indexOf(" ")||(this.$message.error("用户名不能包含空格！"),!1)},checkParams(t){return"修改手机号"===this.dialogTitle||"绑定手机号"===this.dialogTitle?this.$common.isEmpty(this.phone)?(this.$message.error("请输入手机号！"),!1):/^1[345789]\d{9}$/.test(this.phone)?(t.place=this.phone,!0):(this.$message.error("手机号格式有误！"),!1):("修改邮箱"===this.dialogTitle||"绑定邮箱"===this.dialogTitle)&&(this.$common.isEmpty(this.InputParams.email)?(this.$message.error("请输入邮箱！"),!1):!!/^\w+@[a-zA-Z0-9]{2,10}(?:\.[a-z]{2,4}){1,3}$/.test(this.InputParams.email)||(this.$message.error("邮箱格式有误！"),!1))}}},o=n,l=s(81656),c=(0,l.A)(o,i,a,!1,null,null,null),u=c.exports}}]);
//# sourceMappingURL=662.514d89d0.js.map